{% extends "base.html" %}

{% block content %}
  <h1>旅行プラン詳細</h1>

  <div>
    <h2>プラン名: {{ plan.touristplan_name }}</h2>
    <p><strong>開始日:</strong> {{ plan.start_date }}</p>
    <p><strong>終了日:</strong> {{ plan.end_date }}</p>

    <h3>訪問予定日と観光スポット</h3>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>訪問日</th>
          <th>観光スポット</th>
        </tr>
      </thead>
      <tbody>
        {% for visit in visit_date %}
          {% with modal_counter=forloop.counter %}
            <tr>
              <td>{{ visit }}</td>
              <td>
                {% for spot in plan.tourist_spots.all %}
                  {% if spot.visit_date == visit %}
                    <button type="button" class="btn btn-link openWantedSpotModal" data-modal-id="wantedSpotModal{{ modal_counter }}">
                      {{ spot.tourist_spot.name }}
                    </button><br>
                  {% endif %}
                {% endfor %}
                {% if not plan.tourist_spots.all %}
                  <button type="button" class="btn btn-primary openWantedSpotModal" data-modal-id="wantedSpotModal{{ modal_counter }}">
                    行きたいリストを追加
                  </button>
                {% endif %}
              </td>
            </tr>

            <!-- 訪問日に対応するモーダル -->
            <div id="wantedSpotModal{{ modal_counter }}" class="modal" style="display:none;">
              <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2>行きたいリストを追加</h2>
                <p>ここに行きたい観光地リストを表示</p>
              </div>
            </div>
          {% endwith %}
        {% endfor %}
      </tbody>
    </table>

    <a href="{% url 'travelapp:touristplan_list' %}" class="btn btn-secondary">旅行プラン一覧に戻る</a>
  </div>

  <script>
    function openModal(modalId) {
      var modalElement = document.getElementById(modalId);
      if (modalElement) {
        modalElement.style.display = 'block';
      } else {
        console.log("Modal element not found: " + modalId);
      }
    }
    
    function closeModal() {
      var modals = document.querySelectorAll('.modal');
      modals.forEach(function(modal) {
        modal.style.display = 'none';
      });
    }
    
    document.querySelectorAll('.openWantedSpotModal').forEach(function(button) {
      button.addEventListener('click', function() {
        var modalId = this.getAttribute('data-modal-id');
        openModal(modalId);
      });
    });
  </script>

{% endblock %}
