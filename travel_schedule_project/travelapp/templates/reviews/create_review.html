{% extends "base.html" %}

{% block content %}
  <h1>æ–°è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ä½œæˆ</h1>

  <!-- ğŸ”¹ è¦³å…‰åœ°åã¨ç”»åƒã‚’è¡¨ç¤º -->
  <div class="spot-info">
    <h2>{{ tourist_spot.spot_name }}</h2>
      <img src="{{ tourist_spot.picture.url }}" alt="{{ tourist_spot.spot_name }}"> 
  </div>

  <a href="{% url 'travelapp:detail_touristspot' pk=tourist_spot.pk %}">æˆ»ã‚‹</a>
  <form method="post">
    {% csrf_token %}


    <div>
      <label for="{{ form.review_score.id_for_label }}">è©•ä¾¡ã‚¹ã‚³ã‚¢*:</label>
      <div class="rating-stars" id="rating-stars">
        {% for i in "12345" %}
          <span class="star" data-value="{{ i }}">&#9733;</span>
        {% endfor %}
      </div>
      <input type="hidden" name="review_score" value="{{ form.review_score.value|default:1 }}">
      {% if form.review_score.errors %}
        <div class="error">
          {% for error in form.review_score.errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div>
      <label for="{{ form.review_title.id_for_label }}">ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«*:</label>
      {{ form.review_title }}
      {% if form.review_title.errors %}
        <div class="error">
          {% for error in form.review_title.errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div>
      <label for="{{ form.review_description.id_for_label }}">ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹*:</label>
      {{ form.review_description }}
      {% if form.review_description.errors %}
        <div class="error">
          {% for error in form.review_description.errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div>
      <label for="{{ form.review_price.id_for_label }}">ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾¡æ ¼*:</label>
      {{ form.review_price }}
      {% if form.review_price.errors %}
        <div class="error">
          {% for error in form.review_price.errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div>
      <label>æ»åœ¨æ™‚é–“*:</label>
      {{ form.stay_time_hours }} æ™‚ {{ form.stay_time_minutes }} åˆ†
      {% if form.stay_time_hours.errors or form.stay_time_minutes.errors %}
        <div class="error">
          {% for error in form.stay_time_hours.errors %}
            <p>{{ error }}</p>
          {% endfor %}
          {% for error in form.stay_time_minutes.errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <button type="submit">ä½œæˆ</button>
  </form>

<!-- â­ JS for star rating -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.querySelector('input[name="review_score"]');
    let tempRating = ratingInput.value || 1;  // æœ€åˆã®è©•ä¾¡ã‚’ä¿æŒ

    function setRating(rating) {
      stars.forEach((star, index) => {
        if (index < rating) {
          star.classList.add('selected');
        } else {
          star.classList.remove('selected');
        }
      });
      tempRating = rating; // è©•ä¾¡ã‚’æ›´æ–°
      ratingInput.value = rating; // inputã®å€¤ã‚‚æ›´æ–°
    }

    // ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®è©•ä¾¡å¤‰æ›´
    stars.forEach((star, index) => {
      star.addEventListener('mouseover', () => setRating(index + 1)); // 1~5ã®è©•ä¾¡ã«å¤‰æ›´
    });

    // ãƒã‚¦ã‚¹ã‚’é›¢ã—ãŸæ™‚ã«è©•ä¾¡ã‚’ç¢ºå®š
    stars.forEach((star) => {
      star.addEventListener('mouseleave', () => setRating(tempRating)); // é›¢ã—ãŸæ™‚ç‚¹ã®è©•ä¾¡ã‚’æˆ»ã™
    });

    // åˆæœŸçŠ¶æ…‹ã§è©•ä¾¡ã‚’è¨­å®š
    setRating(tempRating);
  });
</script>

<!-- â­ CSS for styling -->
<style>
  .rating-stars {
    display: flex;
    gap: 4px;
  }

  .star {
    font-size: 30px;
    color: #ccc; /* åˆæœŸã®ç©ºã®æ˜Ÿã®è‰² */
    cursor: pointer;
    transition: color 0.2s;
  }

  .star.selected {
    color: gold; /* å¡—ã‚Šã¤ã¶ã—ã®æ˜Ÿ */
  }

  .star:hover {
    color: gold; /* ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®è‰² */
  }
</style>

{% endblock %}
