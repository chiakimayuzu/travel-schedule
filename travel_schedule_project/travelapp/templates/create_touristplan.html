{% extends "base.html" %}

{% block content %}
<h1>旅行プランを作成</h1>

<form method="post">
    {% csrf_token %}
    <label for="touristplan_name">プラン名:</label>
    <input type="text" name="touristplan_name" required>

    <label>訪問開始日: {{ start_date }}</label>
    <label>訪問終了日: {{ end_date }}</label>

    <h2>行きたいリストから観光地を選択</h2>

    <div id="wanted_spots">
        {% for spot in user_wanted_spots %}
        <div>
            <input type="checkbox" name="tourist_spots" value="{{ spot.id }}" class="tourist-spot-checkbox"
                data-spot-id="{{ spot.id }}">
            <label>{{ spot.spot_name }}</label>

            <select name="visit_date_{{ spot.id }}" class="visit-date-dropdown" disabled>
                <!-- JavaScript で日付を挿入 -->
            </select>
        </div>
        {% endfor %}
    </div>

    <button type="submit">プランを作成</button>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let startDate = "{{ start_date }}";
        let endDate = "{{ end_date }}";

        if (startDate && endDate) {
            let start = new Date(startDate);
            let end = new Date(endDate);
            let options = "";

            while (start <= end) {
                let dateStr = start.toISOString().split("T")[0];
                options += `<option value="${dateStr}">${dateStr}</option>`;
                start.setDate(start.getDate() + 1);
            }

            document.querySelectorAll(".visit-date-dropdown").forEach(dropdown => {
                dropdown.innerHTML = options;
            });
        }

        document.querySelectorAll(".tourist-spot-checkbox").forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                let spotId = this.dataset.spotId;
                let dropdown = document.querySelector(`[name='visit_date_${spotId}']`);
                dropdown.disabled = !this.checked;
            });
        });
    });
</script>

<a href="{% url 'travelapp:schedule' %}">戻る</a>
{% endblock %}