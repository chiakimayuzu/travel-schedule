{% extends 'base.html' %}

{% block content %}
<h1>ğŸš©è¦³å…‰åœ°ç™»éŒ²(*ã¯å¿…é ˆã§ã™)</h1>

<!-- extra_tags='regist_touristspot' ã‚’ä½¿ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ã®ã¿ regist_touristspot.html ã§è¡¨ç¤º --> 
{% if messages %} 
<ul class="messages">
  {% for message in messages %}
    {% if 'regist_touristspot' in message.tags %}
      <li class="{{ message.tags }}">{{ message }}</li>
    {% endif %}
  {% endfor %}
</ul>
{% endif %}

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div>
        <label for="{{ form.spot_name.id_for_label }}">è¦³å…‰åœ°å*:</label>
        {{ form.spot_name }}
        {% if form.spot_name.errors %}
            <div class="error">{{ form.spot_name.errors }}</div>
        {% endif %}
    </div>
    <p><span id="spot_name_error" style="display:none; color: red;"></span></p>
    <div>
        <label for="{{ form.prefecture.id_for_label }}">éƒ½é“åºœçœŒ*:</label>
        {{ form.prefecture }}
        {% if form.prefecture.errors %}
            <div class="error">{{ form.prefecture.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.address.id_for_label }}">ä½æ‰€*:</label>
        {{ form.address }}
        {% if form.address.errors %}
            <div class="error">{{ form.address.errors }}</div>
        {% endif %}
    </div>
    <p><span id="address_error" style="display:none; color: red;"></span></p>
    <div>
        <label for="{{ form.tel.id_for_label }}">é›»è©±ç•ªå·*:</label>
        {{ form.tel }}
        {% if form.tel.errors %}
            <div class="error">{{ form.tel.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.category.id_for_label }}">ã‚«ãƒ†ã‚´ãƒª*:</label>
        {{ form.category }}
        {% if form.category.errors %}
            <div class="error">{{ form.category.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.workingday.id_for_label }}">å–¶æ¥­æ—¥ï¼š</label>
        {{ form.workingday }}
        {% if form.workingday.errors %}
            <div class="error">{{ form.workingday.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.opening_at.id_for_label }}">å–¶æ¥­é–‹å§‹æ™‚é–“:</label>
        {{ form.opening_at }}
        {% if form.opening_at.errors %}
            <div class="error">{{ form.opening_at.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.closing_at.id_for_label }}">å–¶æ¥­çµ‚äº†æ™‚é–“:</label>
        {{ form.closing_at }}
        {% if form.closing_at.errors %}
            <div class="error">{{ form.closing_at.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.parking.id_for_label }}">é§è»Šå ´*:</label>
        {{ form.parking }}
        {% if form.parking.errors %}
            <div class="error">{{ form.parking.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.keywords.id_for_label }}">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰*:</label>
        {{ form.keywords }}
        <small>{{ form.keywords.help_text }}</small>
        {% if form.keywords.errors %}
            <div class="error">{{ form.keywords.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.picture.id_for_label }}">ç”»åƒ*:</label>
        {{ form.picture }}
        {% if form.picture.errors %}
            <div class="error">{{ form.picture.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.offical_url.id_for_label }}">å…¬å¼URL*:</label>
        {{ form.offical_url }}
        {% if form.offical_url.errors %}
            <div class="error">{{ form.offical_url.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.description.id_for_label }}">èª¬æ˜*:</label>
        {{ form.description }}
        {% if form.description.errors %}
            <div class="error">{{ form.description.errors }}</div>
        {% endif %}
    </div>


    <div>
        <button type="submit" class="btn btn-primary">ç™»éŒ²</button>
    </div>
</form>



  <script> //select2 ã‚’é©ç”¨
    $(document).ready(function() {
      // select2 ã‚’é©ç”¨ã—ãŸã„ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã¾ã™
      $('.select2').select2();  // ã‚¯ãƒ©ã‚¹å .select2 ã‚’æŒã¤ã™ã¹ã¦ã® <select> è¦ç´ ã«é©ç”¨
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
        function checkDuplicate() {
          const spotName = document.getElementById('id_spot_name').value.trim();
          const address = document.getElementById('id_address').value.trim();
      
          if (spotName || address) {
            const url = `{% url 'travelapp:check_dupe_tourist_spot' %}?spot_name=${encodeURIComponent(spotName)}&address=${encodeURIComponent(address)}`;
      
            fetch(url)
              .then(response => response.json())
              .then(data => {
                const spotNameError = document.getElementById('spot_name_error');
                const addressError = document.getElementById('address_error');
      
                // titleã ã‘ãŒé‡è¤‡ã—ã¦ã„ã‚‹å ´åˆ
                if (data.spot_name_exists) {
                  spotNameError.textContent = "ã“ã®è¦³å…‰åœ°åã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™";
                  spotNameError.style.display = 'block';
                } else {
                  spotNameError.style.display = 'none';
                }
      
                // addressã ã‘ãŒé‡è¤‡ã—ã¦ã„ã‚‹å ´åˆ
                if (data.address_exists) {
                  addressError.textContent = "ã“ã®ä½æ‰€ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™";
                  addressError.style.display = 'block';
                } else {
                  addressError.style.display = 'none';
                }
              })
              .catch(error => console.error('Error:', error));
          }
        }
      
        document.getElementById('id_spot_name').addEventListener("input", checkDuplicate);
        document.getElementById('id_address').addEventListener("input", checkDuplicate);
      });
  </script>

</body>
</html>

{% endblock %}