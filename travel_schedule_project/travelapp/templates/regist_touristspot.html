{% extends 'base.html' %}

{% block content %}
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">送信</button>
  </form>


  <script> //select2 を適用
    $(document).ready(function() {
      // select2 を適用したいセレクトボックスにクラスを付けます
      $('.select2').select2();  // クラス名 .select2 を持つすべての <select> 要素に適用
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      function checkDuplicate() {
        const spotName = document.getElementById('id_spot_name').value.trim();
        const address = document.getElementById('id_address').value.trim();
        
        if (spotName || address) {
          const url = `{% url 'travelapp:check_dupe_tourist_spot' %}?spot_name=${encodeURIComponent(spotName)}&address=${encodeURIComponent(address)}`;
  
          fetch(url)
            .then(response => response.json())
            .then(data => {
              const spotNameError = document.getElementById('spot_name_error');
              const addressError = document.getElementById('address_error');
  
              if (data.spot_name_exists) {
                spotNameError.textContent = "この観光地名は既に登録されています";
                spotNameError.style.display = 'block';
              } else {
                spotNameError.style.display = 'none';
              }
  
              if (data.address_exists) {
                addressError.textContent = "この住所は既に登録されています";
                addressError.style.display = 'block';
              } else {
                addressError.style.display = 'none';
              }
            })
            .catch(error => console.error('Error:', error));
        }
      }
  
      document.getElementById('id_spot_name').addEventListener("input", checkDuplicate);
      document.getElementById('id_address').addEventListener("input", checkDuplicate);
    });
  </script>
  
</body>
</html>

{% endblock %}