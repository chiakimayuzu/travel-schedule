{% extends 'base.html' %}

{% block content %}

<h1 style="font-size: 24px;">ğŸš©è¦³å…‰åœ°ç™»éŒ² <span style="color: red;">(*ã¯å¿…é ˆã§ã™)</span></h1>

<!-- extra_tags='regist_touristspot' ã‚’ä½¿ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ã®ã¿ regist_touristspot.html ã§è¡¨ç¤º --> 
{% if messages %} 
<ul class="messages">
  {% for message in messages %}
    {% if 'regist_touristspot' in message.tags %}
      <li class="{{ message.tags }}">{{ message }}</li>
    {% endif %}
  {% endfor %}
</ul>
{% endif %}

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div>
      <label for="{{ form.spot_name.id_for_label }}">è¦³å…‰åœ°å<span style="color: red;">*</span></label>
      <input type="text" name="spot_name" id="{{ form.spot_name.id_for_label }}" value="{{ form.spot_name.value|default_if_none:'' }}" placeholder="ä¾‹ï¼šæ¸…æ°´å¯º" class="form-control">
      {% if form.spot_name.errors %}
          <div class="error">{{ form.spot_name.errors }}</div>
      {% endif %}
  </div>
  
    <p><span id="spot_name_error" style="display:none; color: red;"></span></p>
    
    <div>
      <label for="{{ form.prefecture.id_for_label }}">éƒ½é“åºœçœŒ<span style="color: red;">*</span></label>
      {{ form.prefecture }}
      {% if form.prefecture.errors %}
          <div class="error">{{ form.prefecture.errors }}</div>
      {% endif %}
  </div>

  <div>
    <label for="{{ form.address.id_for_label }}">ä½æ‰€<span style="color: red;">*</span>&nbsp;&nbsp;<small>ç•ªåœ°ã¯-ã§ã¤ãªã„ã§ãã ã•ã„</small></label>
    <input type="text" name="address" id="{{ form.address.id_for_label }}" value="{{ form.address.value|default_if_none:'' }}" placeholder="ä¾‹ï¼šäº¬éƒ½å¸‚æ±å±±åŒºæ¸…æ°´1-294" class="form-control">
    {% if form.address.errors %}
        <div class="error">{{ form.address.errors }}</div>
    {% endif %}
</div>

    <p><span id="address_error" style="display:none; color: red;"></span></p>
    
    <div>
      <label for="{{ form.tel.id_for_label }}">é›»è©±ç•ªå·<span style="color: red;">*</span></label>
      <input type="tel" name="tel" id="{{ form.tel.id_for_label }}" value="{{ form.tel.value|default_if_none:'' }}" placeholder="ä¾‹ï¼š075-551-1234" class="form-control">
      {% if form.tel.errors %}
          <div class="error">{{ form.tel.errors }}</div>
      {% endif %}
  </div>
  

    <div>
        <label for="{{ form.category.id_for_label }}">ã‚«ãƒ†ã‚´ãƒª<span style="color: red;">*</span></label>
        {{ form.category }}
        {% if form.category.errors %}
            <div class="error">{{ form.category.errors }}</div>
        {% endif %}
    </div>

    <div>
      <label for="{{ form.workingday.id_for_label }}">å–¶æ¥­æ—¥</label>
      <div class="workingday-checkboxes">
        {% for checkbox in form.workingday %}
          <label class="checkbox-inline">
            {{ checkbox.tag }} {{ checkbox.choice_label }}
          </label>
        {% endfor %}
        {% if form.workingday.errors %}
          <div class="error">{{ form.workingday.errors }}</div>
        {% endif %}
      </div>
    </div>
    

    <div>
        <label for="{{ form.opening_at.id_for_label }}">å–¶æ¥­é–‹å§‹æ™‚é–“</label>
        {{ form.opening_at }}
        {% if form.opening_at.errors %}
            <div class="error">{{ form.opening_at.errors }}</div>
        {% endif %}
    </div>

    <div>
      <label for="{{ form.closing_at.id_for_label }}">å–¶æ¥­çµ‚äº†æ™‚é–“</label>
        {{ form.closing_at }}
        {% if form.closing_at.errors %}
            <div class="error">{{ form.closing_at.errors }}</div>
        {% endif %}
    </div>

    <div>
      <label for="{{ form.parking.id_for_label }}">é§è»Šå ´<span style="color: red;">*</span></label>
        {{ form.parking }}
        {% if form.parking.errors %}
            <div class="error">{{ form.parking.errors }}</div>
        {% endif %}
    </div>

    <div id="keyword-container">
      <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰<span style="color: red;">*</span>
        <small>&nbsp;&nbsp;æœ€å¤§10å€‹ã¾ã§ç™»éŒ²å¯èƒ½ã§ã™ / 1ã¤ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯30æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„</small>
      </label>
      <div class="keyword-field">
        <input type="text" name="keywords" class="keyword-input">
        <button type="button" class="remove-btn">âœ•</button>
      </div>
    </div>
    <button type="button" id="add-keyword-btn">ï¼‹ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ </button>

    
    {% if form.non_field_errors %}
      <div class="error">{{ form.non_field_errors }}</div>
    {% endif %}
    

    <div>
      <br><label for="{{ form.picture.id_for_label }}">ç”»åƒ<span style="color: red;">*</span></label>
        {{ form.picture }}
        {% if form.picture.errors %}
            <div class="error">{{ form.picture.errors }}</div>
        {% endif %}
    </div>

    <div>
      <label for="{{ form.offical_url.id_for_label }}">å…¬å¼URL<span style="color: red;">*</span></label>
        {{ form.offical_url }}
        {% if form.offical_url.errors %}
            <div class="error">{{ form.offical_url.errors }}</div>
        {% endif %}
    </div>

    <div>
        <label for="{{ form.description.id_for_label }}">èª¬æ˜<span style="color: red;">*</span></label>
        {{ form.description }}
        {% if form.description.errors %}
            <div class="error">{{ form.description.errors }}</div>
        {% endif %}
    </div>

    <br>
    <div>
      <button type="submit" class="save-button">ç™»éŒ²</button>
    </div>
      
</form>

<script>
$(document).ready(function() {
  // select2 ã‚’é©ç”¨ã™ã‚‹ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚¯ãƒ©ã‚¹ select2 ã‚’æŒ‡å®š
  $('.select2').select2({
    width: '100%',  // å¿…è¦ã«å¿œã˜ã¦å¹…ã‚’èª¿æ•´
    placeholder: "éƒ½é“åºœçœŒã‚’æ¤œç´¢",  // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¨­å®š
    allowClear: true,  // ã‚¯ãƒªã‚¢æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹
  });
});
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      function checkDuplicate() {
        const spotName = document.getElementById('id_spot_name').value.trim();
        const address = document.getElementById('id_address').value.trim();
    
        if (spotName || address) {
          const url = `{% url 'travelapp:check_dupe_tourist_spot' %}?spot_name=${encodeURIComponent(spotName)}&address=${encodeURIComponent(address)}`;
    
          fetch(url)
            .then(response => response.json())
            .then(data => {
              const spotNameError = document.getElementById('spot_name_error');
              const addressError = document.getElementById('address_error');
    
              // titleã ã‘ãŒé‡è¤‡ã—ã¦ã„ã‚‹å ´åˆ
              if (data.spot_name_exists) {
                spotNameError.textContent = "ã“ã®è¦³å…‰åœ°åã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™";
                spotNameError.style.display = 'block';
              } else {
                spotNameError.style.display = 'none';
              }
    
              // addressã ã‘ãŒé‡è¤‡ã—ã¦ã„ã‚‹å ´åˆ
              if (data.address_exists) {
                addressError.textContent = "ã“ã®ä½æ‰€ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™";
                addressError.style.display = 'block';
              } else {
                addressError.style.display = 'none';
              }
            })
            .catch(error => console.error('Error:', error));
        }
      }
    
      document.getElementById('id_spot_name').addEventListener("input", checkDuplicate);
      document.getElementById('id_address').addEventListener("input", checkDuplicate);
    });
</script>
<script>
  const container = document.getElementById('keyword-container');
  const addBtn = document.getElementById('add-keyword-btn');

  addBtn.addEventListener('click', () => {
    const keywordFields = container.querySelectorAll('.keyword-field');
    if (keywordFields.length >= 10) return alert("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯æœ€å¤§10å€‹ã¾ã§ã§ã™");

    const newField = document.createElement('div');
    newField.className = 'keyword-field';
    newField.innerHTML = `
      <input type="text" name="keywords" class="keyword-input">
      <button type="button" class="remove-btn">âœ•</button>
    `;
    container.appendChild(newField);
  });

  container.addEventListener('click', (e) => {
    if (e.target.classList.contains('remove-btn')) {
      e.target.parentElement.remove();
    }
  });
</script>

{% block extra_styles %}
<style>
  form > div {
    margin-bottom: 20px;
  }

  label {
    display: block;
    margin-bottom: 6px;
    font-weight: bold;
    font-size: 16px;
  }

  input[type="text"],
  input[type="url"],
  input[type="file"],
  input[type="tel"],
  select,
  textarea {
    width: 100%;
    padding: 10px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
    margin-bottom: 10px;
  }

  textarea {
    resize: vertical;
    min-height: 100px;
  }

  .error {
    color: red;
    margin-top: -8px;
    margin-bottom: 10px;
    font-size: 14px;
  }

  .workingday-checkboxes {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 1px;  /* ãƒ©ãƒ™ãƒ«ã¨ã®é–“éš”ã‚’ç‹­ãã™ã‚‹ */
    margin-bottom: 10px;
    padding: 0;        /* ä¸Šä¸‹ã®ä½™ç™½ã‚’ç„¡ãã™ */
  }


  .checkbox-inline input[type="checkbox"] {
    margin-right: 6px;
  }



  .messages {
    list-style: none;
    padding: 0;
    margin-bottom: 20px;
  }

  .messages li {
    padding: 10px;
    background-color:rgb(199, 243, 254);
    border: 1px solidrgb(199, 252, 254);
    border-radius: 6px;
    margin-bottom: 0.5rem;
  }
  input[type="file"] {
    padding: 6px 10px;  /* é«˜ã•ã‚„å·¦å³ã®ä½™ç™½ã‚’èª¿æ•´ */
    height: auto;       /* é«˜ã•ã‚’autoã«ã™ã‚‹ã“ã¨ã§æ½°ã‚Œã‚’é˜²ã */
    line-height: 1.5;   /* ãƒ©ãƒ™ãƒ«ã¨ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ */
    background-color: white;
  }

  .save-button {
    display: block;
    width: 100%;
    padding: 12px;
    font-size: 16px;
    background-color: rgb(69, 110, 160);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .save-button:hover {
    background-color: rgb(89, 130, 180); /* ãƒ›ãƒãƒ¼æ™‚ã«èƒŒæ™¯è‰²å¤‰æ›´ */
  }
  #keyword-container {
    margin-bottom: 1rem;
  }
  
  .keyword-field {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
  }
  
  .keyword-input {
    flex: 1;
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-right: 8px;
  }
  
  .remove-btn {
    background-color: #ff5c5c;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 16px;
    width: 28px;
    height: 28px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .remove-btn:hover {
    background-color: #e03e3e;
  }
  
  #add-keyword-btn {
    background-color: #b0b0b0;  /* æŸ”ã‚‰ã‹ã„ã‚°ãƒ¬ãƒ¼ */
    color: #fff;
    font-size: 14px;
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    margin-top: 8px;
  }
  
  #add-keyword-btn:hover {
    background-color: #999999;  /* ãƒ›ãƒãƒ¼ã§å°‘ã—æ¿ƒã */
  }
  #add-keyword-btn {
    margin-bottom: 10px;
  }
</style>
{% endblock %}


{% endblock %}
